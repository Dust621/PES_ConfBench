{
  "topology": "基于网络拓扑图和配置文件分析，增强后的网络拓扑描述如下：\n\n**网络拓扑结构：**\n该网络由5台设备组成，跨越3个自治系统（AS 200、AS 100、AS 300）。DeviceA和DeviceB属于AS 200，DeviceC和DeviceD属于AS 100构成第三方网络，DeviceE属于AS 300。\n\n**物理连接关系：**\n- DeviceA通过GE1/0/0接口（2001:db8:44::1/64）连接DeviceB的GE2/0/0接口（2001:db8:44::2/64）\n- DeviceB通过GE1/0/0接口（2001:db8:11::1/64）连接DeviceC的GE2/0/0接口（2001:db8:11::2/64）\n- DeviceC通过GE1/0/0接口（2001:db8:22::1/64）连接DeviceD的GE2/0/0接口（2001:db8:22::2/64）\n- DeviceD通过GE1/0/0接口（2001:db8:33::1/64）连接DeviceE的GE2/0/0接口（2001:db8:33::2/64）\n\n**Loopback接口配置：**\n- DeviceA: Loopback1 (2001:db8:1::1/128)\n- DeviceB: Loopback1 (2001:db8:2::2/128)\n- DeviceC: Loopback1 (2001:db8:3::3/128)\n- DeviceD: Loopback1 (2001:db8:4::4/128)\n- DeviceE: Loopback1 (2001:db8:5::5/128)\n\n**路由协议配置：**\n- AS 200内部：DeviceA和DeviceB运行ISIS 1协议，网络实体分别为10.0000.0000.0001.00和10.0000.0000.0002.00\n- AS 100内部：DeviceC运行ISIS 100（网络实体20.0000.0000.0001.00），DeviceD运行ISIS 1（网络实体20.0000.0000.0002.00），建立IBGP邻居关系\n- BGP邻居关系：DeviceB-DeviceC、DeviceD-DeviceE之间建立IPv6 EBGP邻居关系\n\n**BGP虚链路配置：**\nDeviceB（2001:db8:2::2）和DeviceE（2001:db8:5::5）之间建立EBGP虚链路，使用各自的Loopback1接口作为连接接口，EBGP最大跳数设置为255，以支持跨越第三方网络的SRv6 TE Policy建立。\n\n**SRv6配置：**\n所有设备配置SRv6 Segment Routing，各设备Locator前缀分别为：\n- DeviceA: 2001:db8:100::/64\n- DeviceB: 2001:db8:200::/64  \n- DeviceC: 2001:db8:333::/64\n- DeviceD: 2001:db8:444::/64\n- DeviceE: 2001:db8:555::/64\n\n**VPN实例：**\nDeviceA和DeviceE配置相同的VPN实例（RD 1:1，RT 1:4），DeviceC和DeviceD配置相同的VPN实例vrftest（RD 1:1，RT 100:1），实现跨域VPN互通。",
  "requirement": "为了跨越第三方网络建立SRv6 TE Policy，可以在DeviceB和DeviceE之间配置BGP邻居的虚链路，并提供SRv6 TE Policy路径计算所需的属性信息，如链路的时延、度量值、亲和属性以及SRLG。这样就能解决DeviceB和DeviceE通过BGP-LS上报链路信息中地址信息不配对，导致控制器无法拼接使用的问题。",
  "steps": [
    "配置DeviceA～DeviceE各接口的IPv6地址。",
    "在DeviceC和DeviceD上使能IS-IS，配置Level级别，指定网络实体。",
    "在DeviceC和DeviceD上配置VPN实例。",
    "在DeviceC和DeviceD之间建立IBGP对等体关系。",
    "在DeviceB和DeviceC之间、DeviceD和DeviceE之间建立EBGP对等体关系。",
    "在DeviceC和DeviceD上配置SRv6 SID，配置IS-IS的SRv6能力，并配置VPN私网路由携带SID属性。",
    "在DeviceC和DeviceD上配置SRv6 TE Policy。",
    "在DeviceC和DeviceD上配置隧道策略，引入私网流量。",
    "在DeviceB和DeviceE之间建立EBGP对等体关系。",
    "在DeviceA和DeviceE上配置VPN实例。",
    "在DeviceA和DeviceE之间建立EBGP对等体关系。",
    "在DeviceA、DeviceB和DeviceE上配置SRv6 SID，配置IS-IS的SRv6能力。在DeviceA和DeviceE上配置VPN私网路由携带SID属性。",
    "在DeviceB和DeviceE上配置BGP EPE和虚链路功能。",
    "在DeviceA和DeviceE上配置SRv6 TE Policy。",
    "在DeviceA和DeviceE上配置隧道策略，引入私网流量。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface gigabitethernet 1/0/0\n ipv6 enable\n ipv6 address 2001:db8:44::1/64\n quit\n#\ninterface loopback 1\n ipv6 enable\n ipv6 address 2001:db8:1::1/128\n commit\n quit\n#\nisis 1\n is-level level-1\n cost-style wide\n network-entity 10.0000.0000.0001.00\n ipv6 enable topology ipv6\n quit\n#\ninterface gigabitethernet 1/0/0\n isis ipv6 enable\n quit\n#\ninterface loopback 1\n isis ipv6 enable\n quit\n#\ncommit\n#\nip vpn-instance vrf\n ipv6-family\n route-distinguisher 1:1\n vpn-target 1:4 export-extcommunity\n vpn-target 1:4 import-extcommunity\n quit\n quit\n#\ninterface loopback 100\n ip binding vpn-instance vrf\n ipv6 enable\n ipv6 address 2001:db8:16::1/128\n quit\n#\ncommit\n#\nbgp 200\n router-id 5.55.5.5\n peer 2001:db8:5::5 as-number 300\n peer 2001:db8:5::5 ebgp-max-hop 255\n peer 2001:db8:5::5 connect-interface LoopBack1\n ipv6-family vpnv6\n peer 2001:db8:5::5 enable\n quit\n quit\n#\ncommit\n#\nsegment-routing ipv6\n encapsulation source-address 2001:db8:1::1\n locator locator1 ipv6-prefix 2001:db8:100::/64 static\n opcode 2001:db8:100::111 end psp\n opcode 2001:db8:100:600 end-op\n quit\n quit\n#\nbgp 200\n ipv6-family vpnv6\n peer 2001:db8:5::5 prefix-sid\n quit\n ipv6-family vpn-instance vrf\n import-route direct\n segment-routing ipv6 traffic-engineer best-effort\n segment-routing ipv6 locator locator1\n quit\n quit\n#\nisis 1\n segment-routing ipv6 locator locator1 auto-sid-disable\n quit\n#\ncommit",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface gigabitethernet 1/0/0\n ipv6 enable\n ipv6 address 2001:db8:11::1/64\n quit\n#\ninterface gigabitethernet 2/0/0\n ipv6 enable\n ipv6 address 2001:db8:44::2/64\n quit\n#\ninterface loopback 1\n ipv6 enable\n ipv6 address 2001:db8:2::2/128\n commit\n quit\n#\nisis 1\n is-level level-1\n cost-style wide\n network-entity 10.0000.0000.0002.00\n ipv6 enable topology ipv6\n ipv6 import-route bgp level-1\n quit\n#\ninterface gigabitethernet 2/0/0\n isis ipv6 enable\n quit\n#\ninterface loopback 1\n isis ipv6 enable\n quit\n#\ncommit\n#\nbgp 200\n router-id 1.11.1.1\n peer 2001:db8:11::2 as-number 100\n ipv6-family unicast\n peer 2001:db8:11::2 enable\n network 2001:db8:2::2/128\n quit\n quit\n#\ncommit\n#\nbgp 200\n peer 2001:db8:5::5 as-number 300\n peer 2001:db8:5::5 ebgp-max-hop 255\n peer 2001:db8:5::5 connect-interface LoopBack1\n ipv6-family unicast\n peer 2001:db8:5::5 enable\n network 2001:db8:1::1/128\n quit\n quit\n#\ncommit\n#\nsegment-routing ipv6\n encapsulation source-address 2001:db8:2::2\n locator locator1 ipv6-prefix 2001:db8:200::/64 static\n opcode 2001:db8:200::222 end psp\n quit\n quit\n#\nisis 1\n segment-routing ipv6 locator locator1 auto-sid-disable\n quit\n#\nbgp 200\n ipv6-family unicast\n network 2001:db8:100::/64\n network 2001:db8:200::/64\n quit\n quit\n#\ncommit\n#\nroute-policy rp deny node 10\n quit",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface gigabitethernet 1/0/0\n ipv6 enable\n ipv6 address 2001:db8:22::1/64\n quit\n#\ninterface gigabitethernet 2/0/0\n ipv6 enable\n ipv6 address 2001:db8:11::2/64\n quit\n#\ninterface loopback 1\n ipv6 enable\n ipv6 address 2001:db8:3::3/128\n commit\n quit\n#\nisis 100\n is-level level-1\n cost-style wide\n network-entity 20.0000.0000.0001.00\n ipv6 enable topology ipv6\n quit\n#\ninterface gigabitethernet 1/0/0\n isis ipv6 enable\n quit\n#\ninterface loopback 1\n isis ipv6 enable\n quit\n#\ncommit\n#\nip vpn-instance vrftest\n ipv6-family\n route-distinguisher 1:1\n vpn-target 100:1 export-extcommunity\n vpn-target 100:1 import-extcommunity\n quit\n quit\n#\ninterface gigabitethernet 2/0/0\n ip binding vpn-instance vrftest\n quit\n#\ncommit\n#\nbgp 100\n router-id 2.22.2.2\n peer 2001:db8:4::4 as-number 100\n peer 2001:db8:4::4 connect-interface LoopBack1\n ipv6-family vpnv6\n peer 2001:db8:4::4 enable\n quit\n quit\n#\ncommit\n#\nbgp 100\n ipv6-family vpn-instance vrftest\n peer 2001:db8:11::1 as-number 200\n quit\n quit\n#\ncommit\n#\nsegment-routing ipv6\n encapsulation source-address 2001:db8:3::3\n locator locator1 ipv6-prefix 2001:db8:333::/64 static\n opcode 2001:db8:333::333 end psp\n quit\n quit\n#\nbgp 100\n ipv6-family vpnv6\n peer 2001:db8:4::4 prefix-sid\n quit\n ipv6-family vpn-instance vrftest\n segment-routing ipv6 traffic-engineer best-effort\n segment-routing ipv6 locator locator1\n quit\n quit\n#\nisis 100\n segment-routing ipv6 locator locator1 auto-sid-disable\n quit\n#\ncommit\n#\nsegment-routing ipv6\n segment-list s1\n index 5 sid ipv6 2001:db8:444::444\n quit\n srv6-te-policy locator locator1\n srv6-te policy policy1 endpoint 2001:db8:4::4 color 100\n candidate-path preference 100\n segment-list s1\n quit\n quit\n quit\n#\ncommit\n#\nroute-policy RP1 permit node 10\n apply extcommunity color 0:100\n quit\n#\nbgp 100\n ipv6-family vpnv6\n peer 2001:db8:4::4 route-policy RP1 import\n quit\n quit\n#\ntunnel-policy tnl_policy\n tunnel select-seq ipv6 srv6-te-policy load-balance-number 1\n quit\n#\nip vpn-instance vrftest\n ipv6-family\n tnl-policy tnl_policy\n commit\n quit\n quit",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface gigabitethernet 1/0/0\n ipv6 enable\n ipv6 address 2001:db8:33::1/64\n quit\n#\ninterface gigabitethernet 2/0/0\n ipv6 enable\n ipv6 address 2001:db8:22::2/64\n quit\n#\ninterface loopback 1\n ipv6 enable\n ipv6 address 2001:db8:4::4/128\n commit\n quit\n#\nisis 1\n is-level level-1\n cost-style wide\n network-entity 20.0000.0000.0002.00\n ipv6 enable topology ipv6\n quit\n#\ninterface gigabitethernet 2/0/0\n isis ipv6 enable\n quit\n#\ninterface loopback 1\n isis ipv6 enable\n quit\n#\ncommit\n#\nip vpn-instance vrftest\n ipv6-family\n route-distinguisher 1:1\n vpn-target 100:1 export-extcommunity\n vpn-target 100:1 import-extcommunity\n quit\n quit\n#\ninterface gigabitethernet 1/0/0\n ip binding vpn-instance vrftest\n quit\n#\ncommit\n#\nbgp 100\n router-id 3.33.3.3\n peer 2001:db8:3::3 as-number 100\n peer 2001:db8:3::3 connect-interface LoopBack1\n ipv6-family vpnv6\n peer 2001:db8:3::3 enable\n quit\n quit\n#\ncommit\n#\nbgp 100\n ipv6-family vpn-instance vrftest\n peer 2001:db8:33::2 as-number 300\n quit\n quit\n#\ncommit\n#\nsegment-routing ipv6\n encapsulation source-address 2001:db8:4::4\n locator locator1 ipv6-prefix 2001:db8:444::/64 static\n opcode 2001:db8:444::444 end psp\n quit\n quit\n#\nbgp 100\n ipv6-family vpnv6\n peer 2001:db8:3::3 prefix-sid\n quit\n ipv6-family vpn-instance vrftest\n segment-routing ipv6 traffic-engineer best-effort\n segment-routing ipv6 locator locator1\n quit\n quit\n#\nisis 1\n segment-routing ipv6 locator locator1 auto-sid-disable\n quit\n#\ncommit\n#\nsegment-routing ipv6\n segment-list s1\n index 5 sid ipv6 2001:db8:333::333\n quit\n srv6-te-policy locator locator1\n srv6-te policy policy1 endpoint 2001:db8:3::3 color 100\n candidate-path preference 100\n segment-list s1\n quit\n quit\n quit\n#\ncommit\n#\nroute-policy RP1 permit node 10\n apply extcommunity color 0:100\n quit\n#\nbgp 100\n ipv6-family vpnv6\n peer 2001:db8:3::3 route-policy RP1 import\n quit\n quit\n#\ntunnel-policy tnl_policy\n tunnel select-seq ipv6 srv6-te-policy load-balance-number 1\n quit\n#\nip vpn-instance vrftest\n ipv6-family\n tnl-policy tnl_policy\n commit\n quit\n quit",
    "DeviceE": "#\nsysname DeviceE\n#\ninterface gigabitethernet 2/0/0\n ipv6 enable\n ipv6 address 2001:db8:33::2/64\n quit\n#\ninterface loopback 1\n ipv6 enable\n ipv6 address 2001:db8:5::5/128\n commit\n quit\n#\nbgp 300\n router-id 4.44.4.4\n peer 2001:db8:33::1 as-number 100\n ipv6-family unicast\n peer 2001:db8:33::1 enable\n network 2001:db8:5::5/128\n quit\n quit\n#\ncommit\n#\nbgp 300\n peer 2001:db8:2::2 as-number 200\n peer 2001:db8:2::2 ebgp-max-hop 255\n peer 2001:db8:2::2 connect-interface LoopBack1\n ipv6-family unicast\n peer 2001:db8:2::2 enable\n quit\n quit\n#\ncommit\n#\nip vpn-instance vrf\n ipv6-family\n route-distinguisher 1:1\n vpn-target 1:4 export-extcommunity\n vpn-target 1:4 import-extcommunity\n quit\n quit\n#\ninterface loopback 100\n ip binding vpn-instance vrf\n ipv6 enable\n ipv6 address 2001:db8:15::1/128\n quit\n#\ncommit\n#\nbgp 300\n ipv6-family vpnv6\n peer 2001:db8:1::1 enable\n quit\n quit\n#\ncommit\n#\nsegment-routing ipv6\n encapsulation source-address 2001:db8:5::5\n locator as1 ipv6-prefix 2001:db8:555::/64 static\n opcode 2001:db8:555::555 end psp\n opcode 2001:db8:555::500 end-op\n quit\n quit\n#\nbgp 300\n ipv6-family unicast\n network 2001:db8:555::/64\n ipv6-family vpnv6\n peer 2001:db8:1::1 prefix-sid\n quit\n ipv6-family vpn-instance vrf\n import-route direct\n segment-routing ipv6 traffic-engineer best-effort\n segment-routing ipv6 locator as1\n quit\n quit\n#\nisis 2\n segment-routing ipv6 locator as1 auto-sid-disable\n quit\n#\ncommit"
  },
  "related_images": [
    "图1-168配置BGP虚链路示意图.png"
  ]
}