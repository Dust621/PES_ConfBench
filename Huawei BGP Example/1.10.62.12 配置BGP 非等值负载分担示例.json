{
  "topology": "网络拓扑由两个自治系统AS100和AS200组成，共包含5台路由器设备。\n\n**AS100内部结构：**\n- DeviceA：RouterID 1.0.0.1，通过interface1(10.1.1.1/24)连接DeviceC，通过interface2(10.1.2.1/24)连接DeviceD，通过interface3(172.16.1.4/24)连接本地网段\n- DeviceB：RouterID 2.0.0.2，通过interface1(172.16.1.5/24)连接本地网段，通过interface2(10.1.3.1/24)连接DeviceC，配置LoopBack0(1.1.1.1/32)用于与DeviceC建立EBGP多跳会话\n\n**AS200内部结构：**\n- DeviceC：RouterID 3.0.0.3，作为核心路由器，通过interface1(10.1.1.2/24)连接DeviceA，通过interface2(10.1.3.2/24)连接DeviceB，通过interface3(10.1.4.1/24)连接DeviceE，配置LoopBack0(2.2.2.2/32)用于与DeviceB建立EBGP多跳会话\n- DeviceD：RouterID 4.0.0.4，通过interface1(10.1.2.2/24)连接DeviceA，通过interface2(10.1.5.1/24)连接DeviceE  \n- DeviceE：RouterID 5.0.0.5，通过interface1(10.1.4.2/24)连接DeviceC，通过interface2(10.1.5.2/24)连接DeviceD\n\n**BGP对等关系：**\n- EBGP连接：DeviceA-DeviceC(10.1.1.1-10.1.1.2)，DeviceA-DeviceD(10.1.2.1-10.1.2.2)，DeviceB-DeviceC(1.1.1.1-2.2.2.2多跳)\n- IBGP连接：DeviceC-DeviceE(10.1.4.1-10.1.4.2)，DeviceD-DeviceE(10.1.5.1-10.1.5.2)\n\n**特殊配置：**\n- 目标网段172.16.1.0/24在AS100中由DeviceA和DeviceB同时宣告\n- DeviceE配置BGP非等值负载分担(UCMP)，支持最大2条路径的负载均衡\n- DeviceC配置链路带宽聚合功能，向DeviceE传递聚合后的带宽信息\n- 所有EBGP连接都配置了链路带宽扩展团体属性的传递",
  "requirement": "在DeviceE上存在两条到达相同目的地址172.16.1.0/24的BGP路由，如果有流量要到达172.16.1.0/24，则既可以通过DeviceC到达，也可以通过DeviceD到达。目的地址为172.16.1.0/24的BGP路由携带链路带宽扩展团体属性，其中DeviceE从DeviceC收到的路由携带的是聚合后的链路带宽扩展团体属性。通过配置BGP非等值负载分担可以根据每条路由的带宽值动态分配流量，减少网络拥塞，充分利用网络资源。",
  "steps": [
    "在DeviceA和DeviceC、DeviceD之间配置EBGP连接。在DeviceB和DeviceC之间配置EBGP连接。在DeviceE和DeviceC、DeviceD之间配置IBGP连接。",
    "在DeviceA与DeviceC、DeviceD配置将扩展团体属性发布给对等体和将BGP路由中携带的带宽扩展团体属性转换成可选过渡属性。在DeviceB与DeviceC配置将扩展团体属性发布给对等体和将BGP路由中携带的带宽扩展团体属性转换成可选过渡属性。",
    "在DeviceA、DeviceB与DeviceC配置允许修改向对等体发布的扩展团体属性。",
    "在DeviceC配置获取DeviceA和DeviceB邻居链路带宽值，并生成扩展团体属性，DeviceC上使能BGP路由基于指定对等体的非等值负载分担的能力。在DeviceD配置获取DeviceA邻居链路带宽值，并生成扩展团体属性，DeviceD上使能BGP路由基于指定对等体的非等值负载分担的能力。",
    "在DeviceC和DeviceD配置将扩展团体属性发布给DeviceE、将BGP路由中携带的链路带宽扩展团体属性转换成可选过渡属性，在DeviceC聚合收到的相同目的地址的多条路由的链路带宽扩展团体属性的功能。",
    "在DeviceC上配置非等值负载分担的功能。在DeviceE上配置非等值负载分担的功能，并设置形成非等值负载分担路由的最大条数。"
  ],
  "configs": {
    "DeviceA": "#\nsysname DeviceA\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.1.1 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.2.1 255.255.255.0\n#\ninterface GE3/0/0\n undo shutdown\n ip address 172.16.1.4 255.255.255.0\n#\nbgp router-id 1.0.0.1\n private-4-byte-as enable\n peer 10.1.1.2 as-number 200\n peer 10.1.2.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n network 172.16.1.0 255.255.255.0\n ext-community-change enable\n peer 10.1.1.2 enable\n peer 10.1.1.2 advertise link-bandwidth transitive\n peer 10.1.1.2 advertise-ext-community\n peer 10.1.2.2 enable\n peer 10.1.2.2 advertise link-bandwidth transitive\n peer 10.1.2.2 advertise-ext-community\n#\nreturn",
    "DeviceB": "#\nsysname DeviceB\n#\ninterface GE1/0/0\n undo shutdown\n ip address 172.16.1.5 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.3.1 255.255.255.0\n#\ninterface LoopBack0\n ip address 1.1.1.1 255.255.255.255\n#\nbgp router-id 2.0.0.2\n private-4-byte-as enable\n peer 2.2.2.2 as-number 200\n peer 2.2.2.2 ebgp-max-hop 255\n peer 2.2.2.2 connect-interface LoopBack0\n#\n ipv4-family unicast\n undo synchronization\n network 172.16.1.0 255.255.255.0\n ext-community-change enable\n peer 2.2.2.2 enable\n peer 2.2.2.2 advertise link-bandwidth transitive\n peer 2.2.2.2 advertise-ext-community\n#\nip route-static 2.2.2.0 255.255.255.0 10.1.3.2\n#\nreturn",
    "DeviceC": "#\nsysname DeviceC\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.1.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.3.2 255.255.255.0\n#\ninterface GE3/0/0\n undo shutdown\n ip address 10.1.4.1 255.255.255.0\n#\ninterface LoopBack0\n ip address 2.2.2.2 255.255.255.255\n#\nbgp router-id 3.0.0.3\n private-4-byte-as enable\n peer 1.1.1.1 as-number 100\n peer 1.1.1.1 ebgp-max-hop 255\n peer 1.1.1.1 connect-interface LoopBack0\n peer 10.1.1.1 as-number 100\n peer 10.1.4.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n load-balancing ucmp\n ext-community-change enable\n peer 1.1.1.1 enable\n peer 1.1.1.1 generate-link-bandwidth all\n peer 1.1.1.1 load-balancing\n peer 10.1.1.1 enable\n peer 10.1.1.1 generate-link-bandwidth\n peer 10.1.1.1 load-balancing\n peer 10.1.4.2 enable\n peer 10.1.4.2 advertise link-bandwidth transitive\n peer 10.1.4.2 aggregate-link-bandwidth\n peer 10.1.4.2 advertise-ext-community\n#\nip route-static 1.1.1.0 255.255.255.0 10.1.3.1\n#\nreturn",
    "DeviceD": "#\nsysname DeviceD\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.2.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.5.1 255.255.255.0\n#\nbgp router-id 4.0.0.4\n private-4-byte-as enable\n peer 10.1.2.1 as-number 100\n peer 10.1.5.2 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n peer 10.1.2.1 enable\n peer 10.1.2.1 generate-link-bandwidth\n peer 10.1.5.2 enable\n peer 10.1.5.2 advertise link-bandwidth transitive\n peer 10.1.5.2 advertise-ext-community\n#\nreturn",
    "DeviceE": "#\nsysname DeviceE\n#\ninterface GE1/0/0\n undo shutdown\n ip address 10.1.4.2 255.255.255.0\n#\ninterface GE2/0/0\n undo shutdown\n ip address 10.1.5.2 255.255.255.0\n#\nbgp router-id 5.0.0.5\n private-4-byte-as enable\n peer 10.1.4.1 as-number 200\n peer 10.1.5.1 as-number 200\n#\n ipv4-family unicast\n undo synchronization\n maximum load-balancing 2\n load-balancing ucmp\n peer 10.1.4.1 enable\n peer 10.1.5.1 enable\n#\nreturn"
  },
  "related_images": [
    "图1-154 配置BGP 非等值负载分担组网图.png"
  ]
}